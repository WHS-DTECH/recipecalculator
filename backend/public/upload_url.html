<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Upload Recipe by URL</title>
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="admin_styles.css">
</head>
<body>
		<div id="navbar-include"></div>
		<script src="shared/navbar_loader.js"></script>
	<link rel="stylesheet" href="../shared/style.css">
</head>
<body>
	<div id="cleanupProgressBar" style="display:none;position:fixed;top:0;left:0;width:100vw;height:6px;z-index:9999;background:#eee;">
		<div id="cleanupProgressFill" style="height:100%;width:0;background:#008080;transition:width 0.2s;"></div>
	</div>
	<!-- Dynamic Navbar Include -->
	<div id="navbar-include"></div>
	<script src="../shared/navbar_loader.js"></script>
	<div class="setup-card main-content-margins">
		<h2>Recipe Book Setup (Upload Recipe by URL)</h2>
		<div class="setup-section">
			<div class="setup-section-title">Load Recipe (URL)</div>
			<div class="setup-section-desc">Import recipe from a website URL.</div>
			<label class="recipe-url-label standout-label">Recipe URL:</label>
			<input type="text" class="setup-url-input wide-url-input super-wide-url-input" placeholder="e.g., https://www.chelsea.co.nz/browse-recipes/...">
			<button class="setup-btn upload-url-btn standout-btn" id="uploadUrlBtn">Upload URL</button>
			<button id="syncUploadedToRecipesBtn" style="margin-left:1rem;background:#388e3c;color:#fff;border:none;padding:0.4rem 1rem;border-radius:4px;cursor:pointer;">Sync Uploaded Recipes to Recipes Table</button>
			<hr style="margin:1.2rem 0 1.2rem 0;">
			<div style="font-size:1.25rem;font-weight:bold;color:#1976d2;margin-bottom:0.7rem;">Extract Recipe Information</div>
			<div style="margin-top:1rem;">
				<button class="setup-btn" style="background:#8000b0; color:#fff;" onclick="window.location.href='extractor_raw.html'">Raw Data Extractor</button>
				<button class="setup-btn" style="margin-left:1rem;" onclick="window.location.href='extractor_serving_size.html'">Serving Size Extractor</button>
				<button class="setup-btn" style="margin-left:1rem; background:#008080; color:#fff;" onclick="window.location.href='extractor_instructions.html'">Instructions Text Extractor</button>
				<button class="setup-btn" style="margin-left:1rem; background:#4B0082; color:#fff;" onclick="window.location.href='extractor_ingredient.html'">Ingredients Text Extractor</button>
				<button class="setup-btn" style="margin-left:1rem; background:#e040fb; color:#fff;" onclick="window.location.href='extractor_title.html'">Title Extractor</button>
			</div>
			<hr style="margin:1.2rem 0 1.2rem 0;">
			<div style="font-size:1.25rem;font-weight:bold;color:#1976d2;margin-bottom:0.7rem;">Clean up for Display</div>
			<div style="margin-bottom:1.2rem;">
				<button class="setup-btn" style="background:#008080;color:#fff;margin-right:1rem;">Cleanup Instructions</button>
				<button class="setup-btn" style="background:#4B0082;color:#fff;">Cleanup Ingredients</button>
			</div>
		</div>
		<hr>
		<!-- Move Raw Data Preview next to Raw Data Extractor button -->
		<div style="display:flex; align-items:center; margin-bottom:1rem;">
			<button id="transferInstructionsMainBtn" class="setup-btn" style="background:#a020f0; color:#fff; margin-right:1rem; display:none;">Transfer Instructions</button>
			<div id="rawDataPreviewWindow" style="width:420px; min-height:90px; height:110px; max-height:160px; background:#f8f8ff; border:1.5px solid #bdbdbd; border-radius:8px; box-shadow:0 2px 8px #0001; padding:0.7rem 1rem; overflow:auto; font-size:0.97em; color:#333; display:flex; flex-direction:column; align-items:flex-start; justify-content:flex-start; z-index:2; display:none;">
				<div style="font-weight:bold; color:#8000b0; font-size:1em; margin-bottom:0.3em;">Raw Data Preview</div>
				<pre id="rawDataPreviewText" style="margin:0; padding:0; background:none; border:none; font-size:0.97em; max-width:100%; max-height:120px; overflow:auto; white-space:pre-wrap;"></pre>
			</div>
		</div>
		<hr>
		
		<!-- Main Recipes Table -->
		<div class="setup-section">
			<div class="setup-section-title">Extracted Recipes</div>
			<div class="setup-section-desc">View recipes currently in the database.</div>
			<table id="mainRecipesTable" style="width:100%;margin-top:1rem;border-collapse:collapse;">
				<thead>
					<tr style="background:#f5f5f5;">
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">ID</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">UploadedRecipeID</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Recipe Name</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Description</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee; color:indigo;">Extracted Ingredients</th>
						<th style="padding:0.5rem 1.5rem; min-width:220px; border:1px solid #eee; color:#1976d2;">Ingredients Display</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee; color:indigo;">Extracted Serving Size</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Instructions</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee; color:purple;">Extracted Instructions</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee; color:#009688;">Raw Data Table</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">URL</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Actions</th>
					</tr>
				</thead>
				<tbody>
					<!-- Populated by JS -->
				</tbody>
			</table>
		</div>
		<!-- Uploaded Recipes Table -->
		<div class="setup-section">
			<div class="setup-section-title">Uploaded Recipes</div>
			<div class="setup-section-desc">View details of uploaded recipes.</div>
			<table id="uploadedRecipesTable" style="width:100%;margin-top:1rem;border-collapse:collapse;">
				<thead>
					<tr style="background:#f5f5f5;">
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">ID</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Recipe Title</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Upload Type</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Source URL</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Uploaded By</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Upload Date</th>
						<th style="padding:0.5rem 0.7rem;border:1px solid #eee;">Actions</th>
					</tr>
				</thead>
				<tbody>
					<!-- Populated by JS -->
				</tbody>
			</table>
		</div>
	</div>
	<script src="upload_url.js?v=20260127"></script>
	<script>
	document.getElementById('syncUploadedToRecipesBtn').addEventListener('click', function() {
		if (confirm('This will insert any uploaded recipes not yet in the Recipes table. Continue?')) {
			fetch('/api/recipes/sync-from-uploads', { method: 'POST' })
				.then(res => res.json())
				.then(data => {
					if (data.success) {
						alert('Sync complete: ' + data.inserted + ' recipes added.');
						location.reload();
					} else {
						alert('Sync failed.');
					}
				})
				.catch(() => alert('Error contacting server.'));
		}
	});
	</script>
</body>
</html>
